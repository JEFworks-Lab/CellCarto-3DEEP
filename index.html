<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CellCarto - Cellular Cartography Spatial Transcriptomics Data Explorer</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="container">
        <div id="left-panel">
            <div class="panel-content">
                <div id="description-section">
                    <h1>3DEEP Hair Follicle Data Explorer</h1>
                    <div id="description">
                        <p>3DEEP is a tissue clearing and spatial transcriptomic strategy for characterizing tissue blocks up to 400 µm in thickness. This data captures 371 hair follicles at different stages of organogenesis in 1 mm³ of skin of a 12-hour-old mouse with 6 million transcripts from 81 genes. Data is randomly downsampled for performance and demo purposes.</p>                    
                        <br>
                        <p>
                            <b><u>Usage:</u></b>
                            Use the mouse to pan and zoom. 
                            Hold the Control key to rotate.
                            Hold the Shift key and hover over transcripts for more information.
                            Color by gene or other transcript features. Click the legend to change the color. 
                            Filter by transcript features. 
                        </p>
                        <br>
                    </div>
                </div>

                <div id="legend-section">
                    <h2>Legend</h2>
                    <button id="randomizeColors" style="display: none;">Randomize Colors</button>
                    <div id="legend" class="legend"></div>
                </div>
            </div>
        </div>

        <div id="center-panel">
            <canvas id="scene"></canvas>
            <div id="loading">
                <div class="loading-spinner"></div>
                <div class="loading-text">Loading data... This may take a moment.</div>
            </div>
        </div>

        <div id="right-panel">
            <div class="panel-content">
                <h2>Controls</h2>
                
                <div class="control-group">
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px;">
                        <div>
                            <label for="coordX">X-Axis:</label>
                            <select id="coordX" style="width: 100%;"></select>
                        </div>
                        <div>
                            <label for="coordZ">Y-Axis:</label>
                            <select id="coordZ" style="width: 100%;"></select>
                        </div>
                        <div>
                            <label for="coordY">Z-Axis:</label>
                            <select id="coordY" style="width: 100%;"></select>
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <label for="colorBy">Color By:</label>
                    <select id="colorBy">
                    </select>
                </div>

                <div class="control-group">
                    <label>Filters:</label>
                    <button id="addFilter">+ Add Filter</button>
                    <div id="filtersContainer"></div>
                </div>

                <div class="control-group">
                    <label for="pointSize">Point Size:</label>
                    <input type="range" id="pointSize" min="0.1" max="5" step="0.1" value="1">
                    <span id="pointSizeValue">1.0</span>
                </div>

                <div class="control-group">
                    <label for="sampleRate">Data Loaded:</label>
                    <input type="range" id="sampleRate" min="10" max="100" step="10" value="10">
                    <span id="sampleRateValue">10%</span>
                </div>

                <div class="info">
                    <p id="pointCount">Loading data...</p>
                    <p id="visibleCount">Visible points: 0</p>
                </div>

                <div class="control-group">
                    <button id="resetCamera">Reset Camera</button>
                </div>

                <div class="control-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="autoRotate">
                        Auto-rotate
                    </label>
                </div>

                <div class="control-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="autoShift">
                        Auto-shift (animate TimeRank)
                    </label>
                    <span id="autoShiftStatus" style="font-size: 0.85em; color: #95a5a6; display: none;"></span>
                </div>
            </div>
        </div>
    </div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.128.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.128.0/examples/jsm/"
        }
    }
    </script>
    <script type="module" src="app.js"></script>
</body>
</html>